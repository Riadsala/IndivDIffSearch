---
title: "Supplementary Materials"
output:
  bookdown::html_document2:
    toc: yes
    toc_depth: 2
    fig_caption: yes
---

```{r setup, include=FALSE}
# setting options
knitr::opts_chunk$set(echo = TRUE)

# Packages
library(tidyverse)
library(ggthemes)
library(gridExtra)
library(knitr)

# what data do we need?
# get line seg acc and rt 
ls_acc_RT <- readRDS(file = "../../Scripts/lineseg/scratch/processedRTandAccData.Rda")


```

# Methods 
## Split-Half
In this task, a chin rest with forehead bar was used in order to ensure a viewing distance of 47cm. Participants' fixations were tracked using a deskmounted Eylink 1000 (version 4.594) to record eye position at 1000 Hz. Prior to every block, a 9-point calibration was carried out. This task lasted approximately 30 minutes.

The line segments subtended approximately 1.6&deg; of visual angle. 

Any other details needed?


## Adaptive Choice
For this task, participants were sat approximately 47cm from the screen though no chin rest was used to ensure a constant viewing distance. Participants were give 10 practice trials before starting the actual experiment which consisted of 288 trials. Participants were told they were to search for a target number (2-5 inclusive). There would be two of these target numbers on every trial; one in a blue square and one in a red square. They were told they only needed to report one of these numbers. The squares subtended between ~1.1&deg; and ~1.3&deg; depending on the screen resolution the participant was tested at (either 1600x1200 or 1400x1050, respectively). Participants were instructed to be as fast and accuracte as possible. They were also told there would be a tone if they were to report a number that was not present within any of the boxes matching the two target colours. 

## Foraging 
Same as the in the Adaptive Choice task, participants were not sat in a chin rest and so viewing distance was approximately. There were 84 objects on screen, half of which were the targets for that trial. The squares and circles subtended between ~0.6&deg; and ~0.7&deg; depending on the screen resolution the participant was tested at (either 1600x1200 or 1400x1050, respectively).

Before starting the experiment, participants had 5 practice trials to familiarise themeselves with the task, after which they would begin the real task which cosisted of 20 trials. After completing the task with either the feature or conjunction search, participants would then repeat the task in the remaining condition. This took approximately 20 minutes. 

# Participants

```{r Participants, echo = FALSE}
# sort out participants 
ls_acc_RT$observer <- as.numeric(as.factor(as.numeric(ls_acc_RT$observer)))

# number of participants used
num_participants <- length(unique(ls_acc_RT$observer))

```

```{r processing ls data, echo = FALSE, include = FALSE}
# load in unprocessed data 
load("../../Scripts/lineseg/scratch/unfiltered_fixDat")
load("../../Scripts/lineseg/scratch/unfiltered_trlDat")
trlDat_unf <- trlDat
# tidy 
rm(trlDat)

# sort out participant levels 
fixDat$observer <- as.numeric(as.factor(as.numeric(fixDat$observer)))

fixDat_unf <- fixDat
# tidy 
rm(fixDat)

#### getting accuracy and mistaken keys ####
invalid_kp <- trlDat_unf %>%
  group_by(responseKey) %>%
  summarise(n = n()) %>%
  filter(responseKey == "Key_x")
invalid_kp <- invalid_kp$n


# filter out bad participants 
avg_acc_all <- ls_acc_RT %>%
  filter(observer != 15,
         observer != 25,
         observer != 47,
         observer != 48) %>%
  group_by(observer, targSide) %>%
  summarise(Acc = mean(accuracy))

#### get number of incorrect trials ####
incorrect_trials <- ls_acc_RT %>%
  filter(observer != 15,
         observer != 25,
         observer != 47,
         observer != 48,
         responseKey != "Key_x") %>%
  group_by(accuracy) %>%
  summarise(n = n())

# min acc easy 
min_easy <- round(min(avg_acc_all$Acc[avg_acc_all$targSide == "easy"]), digits = 3)*100

# min acc absent 
min_absent <- round(min(avg_acc_all$Acc[avg_acc_all$targSide == "absent"]), digits = 3)*100


#### sorting out fixation data #### 
num_fixations <- nrow(fixDat_unf)

# get removed fixations data 
load("../../Scripts/lineseg/scratch/processedFixationData")
# get difference value 
num_removed <- num_fixations - nrow(fixDat)

  
```

```{r processing ACS data, echo = FALSE}
# load data 
load("scratch/dat_ACS")

# filter out participants that were removed 
dat_ACS <- dat_ACS %>%
  filter(SubNo >= 5)

# probably want to work out things like accuracy etc?
# as in, exclude participants that are around chance level 

```

```{r processing Foraging data, echo = FALSE}
# load data 
load("scratch/dat_for")

# filter out participants that were removed 
dat_for <- dat_for %>%
  filter(sub_no >= 5)

```
Data was collected from 64 Participants as originally planned. Four of these participants did not complete all parts of the experiment (either declining to participate in the second session, or could not be calibrated with the eye tracker), so four new participants were recruited to bring the total back up to `r num_participants`.

## Split-Half
Accuracy data is shown in Figure \ref{fig:acc_plt}. From this we can see that there are a number of outliers: 15, 25, 47, and 48 (NB: these may have changed with new labelling). These participants, in at least one session, either missed the majority of easy targets, or responded with false positives on the majority of target absent trials. After removing these participants, the lowest accuracy in either session was `r paste(min_easy,"%", sep = "")` for the easy targets, and `r paste(min_absent, "%", sep = "")` for target absent trials. This leaves us with `r length(unique(avg_acc_all$observer))` participants for the split-half paradigm.

```{r acc_plt, fig.cap = "\\label{fig:acc_plt} Accuracy data for each participant for the split-half paradigm. ", echo = FALSE, fig.align = "center"}
# make the plot
plt <- ls_acc_RT %>%
  group_by(observer, targSide, session) %>%
  summarise(Accuracy = mean(accuracy)) %>%
  ggplot(aes(targSide, Accuracy, fill = session)) + 
  geom_bar(stat = "identity", position = position_dodge()) + 
  scale_y_continuous(breaks = c(0,1)) + 
  theme_bw() +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "top", strip.text.x = element_text(margin = margin(0.01,0,0.01,0, "mm"))) + 
  scale_fill_ptol() +
  facet_wrap(~observer)
plt$labels$x <- "Target Condition"
plt
```

```{r rt_plt, fig.cap = "\\label{fig:rt_plt} Distribution of reaction times in split-half paradigm.", echo = FALSE, warning = FALSE, message = FALSE, fig.align = "center"}
plt <- ls_acc_RT %>%
  ggplot(aes(rt)) + 
  geom_histogram() + 
  theme_bw() +  
  facet_wrap(~targSide)
plt$labels$x <- "Response Time (msecs)"
plt2 <- ls_acc_RT %>%
  mutate(log2_RT = log2(rt)) %>%
  ggplot(aes(log2_RT)) + 
  geom_histogram() + 
  theme_bw() +
  facet_wrap(~ targSide)
plt2$labels$x <- "log2 Response Time"

# put together 
grid.arrange(plt,plt2)
```

# Data Processing


## Split-Half 
`r invalid_kp` trials with invalid key responses were removed. After removing data from the four outlier participants (see above), all remaining incorrect trials (n = `r incorrect_trials$n[incorrect_trials$accuracy == 0]`) were removed, leaving a total of `r incorrect_trials$n[incorrect_trials$accuracy == 1]` trials over 60 participants.

### Reaction Times 
As expected, reaction times were highly skewed (Figure 2), so were log2 transformed (in ms units) before the participant means were calculated for each session and target condition (Figure )

### Eye Movements
`r num_fixations` fixations were recorded. Of these, `r num_removed` fell outside of the stimuli area and were removed. Fixations landing within a vertical strip consisting of 10% of the stimuli's width were classed as central. All remaining fixations were then classed as landing on the homogeneous or heterogeneous half of the stimulus. Initial fixations were not included in the analysis. Numbers of fixations are given in Table 2. 

```{r make table, echo = FALSE, results='asis'}
# get fixation location
fixDat <- fixDat %>%
  mutate(fix_loc = "central")
fixDat$fix_loc[fixDat$x < -0.1 & fixDat$easySide == "left"] <- "homogenous"
fixDat$fix_loc[fixDat$x > 0.1 & fixDat$easySide == "right"] <- "homogenous"
fixDat$fix_loc[fixDat$x < -0.1 & fixDat$easySide == "right"] <- "heterogenous"
fixDat$fix_loc[fixDat$x > 0.1 & fixDat$easySide == "left"] <- "heterogenous"

# get num fixations in these locations 
table_dat_all <- fixDat %>%
  group_by(targSide, fix_loc) %>%
  filter(n < 6) %>%
  summarise(number = n()) %>%
  mutate(range = "1 < n")

table_dat_2_to_5 <- fixDat %>%
  group_by(targSide, fix_loc) %>%
  filter(n >= 2,
         n <= 5) %>%
  summarise(number = n()) %>%
  mutate(range = "2 <= n <= 5")

table_dat <- rbind(table_dat_all, table_dat_2_to_5) %>%
  spread(range, number)

# make table 
kable(table_dat, caption = "table thing")
```

## Adaptive Choice
```{r ACS plotting, echo = FALSE, message = FALSE, fig.align = "center"}
# what sort of things do we care about....

# RT by optimal choice
plt <- dat_ACS %>%
  na.omit() %>%
  mutate(Optimal_Choice = as.factor(Optimal_Choice)) %>%
  filter(Block_num > 0) %>%
  mutate(se = sd(RT)/sqrt(n())) %>%
  filter(RT > RT - 3*se,
         RT < RT + 3*se,
         RT > 300) %>%
  ggplot(aes(RT/1000, fill = Optimal_Choice)) + 
  geom_histogram() +
  theme_bw() + 
  theme(strip.text.x =  element_blank()) + 
  coord_cartesian(expand = FALSE) + 
  scale_fill_ptol() +
  facet_wrap(~ Optimal_Choice) 
plt$labels$x <- "Response Time (secs)"
plt$labels$fill <- "Optimal Choice"
plt

# what about RT by number of optimal choices
# only: - correct trials
#       - RT > 300ms
plt2 <- dat_ACS %>%
  na.omit() %>%
  filter(Block_num > 0) %>%
  mutate(se = sd(RT)/sqrt(n())) %>%
  filter(RT > RT - 3*se,
         RT < RT + 3*se,
         RT > 300) %>%
  group_by(SubNo) %>%
  summarise(mean_RT = mean(RT),
            sum_optchoices = sum(Optimal_Choice)) %>%
  ggplot(aes(sum_optchoices, mean_RT, label = SubNo)) + 
  geom_point() + 
  geom_text() + 
  theme_bw()
plt2

# Get accuracy for each participant 
# probably want to exclude participant 39 going by their accuracy 
plt3 <- dat_ACS %>%
  filter(Block_num > 0) %>%
  mutate(se = sd(RT)/sqrt(n())) %>%
  filter(RT > RT - 3*se,
         RT < RT + 3*se,
         RT > 300) %>%
  group_by(SubNo) %>%
  summarise(mean_acc = mean(Acc)) %>%
  mutate(mean_acc_ov = mean(mean_acc)) %>%
  ggplot(aes(SubNo, mean_acc)) + 
  geom_point() + 
  theme_bw()
plt3

```


## Foraging


---
title: "Supplementary Materials"
output:
  pdf_document:
    toc: yes
    toc_depth: 2
    fig_caption: yes
fig_height: 4
fig_width: 6
---

```{r setup, include=FALSE}
# setting options
knitr::opts_chunk$set(echo = TRUE)

# Packages
library(tidyverse)
library(ggthemes)
library(gridExtra)
library(knitr)

# what data do we need?
# get line seg acc and rt 
ls_acc_RT <- readRDS(file = "../../Scripts/lineseg/scratch/processedRTandAccData.Rda")


```

# Methods 
The experiment took part over two sessions both lasting approximately 1 hour. All participants reported normal or corrected to normal vision and were from the University of Aberdeen. Participants were either compensated with course credit or £15 for their time. All participants gave informed consent. 

All tasks were completed on a 17-inch CRT monitor with a resolution of 1400$x$1050 (*n* = 40) or 1600$x$1200 (*n* = 24). All tasks were programmed in MATLAB using the psychophysics and eyelink toolboxes. 

## Split-Half
In this task, a chin rest with forehead bar was used in order to ensure a viewing distance of 47cm. Participants' fixations were tracked using a deskmounted Eylink 1000 (version 4.594) to record eye position at 1000 Hz. Prior to every block, a 9-point calibration was carried out. This task lasted approximately 30 minutes and was carried out in both sessions

Participants were instructed to state the presence, or absence, of a small target line segment that was tilted 45&deg; to the right. The distractor line segments were arranged in such a way to create a "hard" and "easy" search side. All distractors were orthogonal to the target with either a low variance (18&deg;) which created a relatively homogenous texture ("easy" side), or a high amount of variance (95&deg;) creating a more heterogenous texture ("hard" side). The line segments subtended approximately 1.6&deg; of visual angle. For 50% of the trials, there was a target present. Particiapnts were told to establish whether the target was present or absent on each trial as quickly and as accuractely as possible. 

In total, particiapnts completed 160 trials in each session with the hetero- and homogenous side randomly varying from trial to trial. 


## Adaptive Choice
For this task, participants were sat approximately 47cm from the screen though no chin rest was used to ensure a constant viewing distance. The search display consisted of small red, blue, and green squares arranged in three rings around a fixation point. the squares subtended between ~1.1&deg; and ~1.3&deg; depending on the screen resolution the participant was tested at (either 1600$x$1200 or 1400$x$1050, respectively). The participants' task was to find the blue or red square that contained the a number between 2 and 5 inclusive. On every trial there, both target colour squares contained a number between 2 and 5, but participants were told they only needed to report one of them. To ensure we could tell which colour they had decided, the blue and red target squares would always have a different number. The distractor blue and red squares would always contain a number between 6 and 9. The green squares contained numbers between 2 and 9. Again, they were instructed to complete the task as quickly and as accurately as possible. 

Before starting the task, participants weregiven 10 practice trials and were free to ask any questions before starting the main expriment. If a participant was to report a number that was not in one of the two target boxes, a tone would sound to alert them to their mistake. 

At the beginning of the experiment, there would be more red than blue squares (**need to check this is accuracte**) for five trials. Then, across the next seven trials, these would gradually change from red to blue, stay blue for five, and change etc. After completing the task, participants were then asked to fill out a short 3 item question asking them about their strategy and whether they noticed the gradual shift from one colour being the majority to the other. 

## Foraging 
Same as the in the Adaptive Choice task, participants were not sat in a chin rest and so viewing distance was approximately 47cm. In this task, participants were presented with 84 small objects on the screen which subtended between ~0.6&deg; and ~0.7&deg; depending on the screen resolution the participant was tested at (either 1600$x$1200 or 1400$x$1050, respectively). Half of these were target items that participants were to click on until they had collected all of them. There were two types of search with this task. Either a feature search in which participants were presented with circles of 4 different colours (red, blue, yellow, and green) in which they were to click on all circles of two of the colours (e.g. click on the red and green, not the blue and yellow). The other being a conjunction search in which there were squares and circles coloured with two of the four possible colours, for example, they could be tasked with clicking on the blue squares and yellow circles, but try to avoid the blue circles and yellow squares. Participants completed both of these and the order was counterbalanced with the colours of the targets being randomised.  

Before starting the experiment, participants had 5 practice trials to familiarise themeselves with the task, after which they would begin the real task which cosisted of 20 trials. After completing the task with either the feature or conjunction search, participants would then repeat the task in the remaining condition. This took approximately 20 minutes. 

# Participants

```{r Participants, echo = FALSE}
# sort out participants 
ls_acc_RT$observer <- as.numeric(as.factor(as.numeric(ls_acc_RT$observer)))

# number of participants used
num_participants <- length(unique(ls_acc_RT$observer))

```

```{r processing ls data, echo = FALSE, include = FALSE}
# load in unprocessed data 
load("../../Scripts/lineseg/scratch/unfiltered_fixDat")
load("../../Scripts/lineseg/scratch/unfiltered_trlDat")
trlDat_unf <- trlDat
# tidy 
rm(trlDat)

# sort out participant levels 
fixDat$observer <- as.numeric(as.factor(as.numeric(fixDat$observer)))

fixDat_unf <- fixDat
# tidy 
rm(fixDat)

#### getting accuracy and mistaken keys ####
invalid_kp <- trlDat_unf %>%
  group_by(responseKey) %>%
  summarise(n = n()) %>%
  filter(responseKey == "Key_x")
invalid_kp <- invalid_kp$n


# filter out bad participants 
avg_acc_all <- ls_acc_RT %>%
  filter(!observer %in% c(15, 25, 47, 48)) %>%
  group_by(observer, targSide) %>%
  summarise(Acc = mean(accuracy))

#### get number of incorrect trials ####
incorrect_trials <- ls_acc_RT %>%
  filter(!observer %in% c(15, 25, 47, 48),
         responseKey != "Key_x") %>%
  group_by(accuracy) %>%
  summarise(n = n())

# min acc easy 
min_easy <- round(min(avg_acc_all$Acc[avg_acc_all$targSide == "easy"]), digits = 3)*100

# min acc absent 
min_absent <- round(min(avg_acc_all$Acc[avg_acc_all$targSide == "absent"]), digits = 3)*100


#### sorting out fixation data #### 
num_fixations <- nrow(fixDat_unf)

# get removed fixations data 
load("../../Scripts/lineseg/scratch/processedFixationData")
# get difference value 
num_removed <- num_fixations - nrow(fixDat)

  
```

```{r processing ACS data, echo = FALSE}
# load data 
load("scratch/dat_ACS")

# filter out participants that were removed 
dat_ACS <- dat_ACS %>%
  filter(SubNo >= 5)

# probably want to work out things like accuracy etc?
# as in, exclude participants that are around chance level 

# add in log2 RT 
# there is a trial with RT 0 so make sure RT is greater than that too
dat_ACS <- dat_ACS %>%
  mutate(log2_RT = log2(RT)) %>%
  filter(RT > 0)


```

```{r processing Foraging data, echo = FALSE}
# load data 
load("scratch/dat_for")

# filter out participants that were removed 
dat_for <- dat_for %>%
  filter(sub_no >= 5)

```
Data was collected from 64 Participants as originally planned. Four of these participants did not complete all parts of the experiment (either declining to participate in the second session, or could not be calibrated with the eye tracker), so four new participants were recruited to bring the total back up to `r num_participants`.

## Split-Half
Accuracy data is shown in Figure \ref{fig:acc_plt}. From this we can see that there are a number of outliers: 15, 25, 47, and 48. These participants, in at least one session, either missed the majority of easy targets, or responded with false positives on the majority of target absent trials. After removing these participants, the lowest accuracy in either session was `r paste(min_easy,"%", sep = "")` for the easy targets, and `r paste(min_absent, "%", sep = "")` for target absent trials. This leaves us with `r length(unique(avg_acc_all$observer))` participants for the split-half paradigm.

```{r acc_plt, fig.cap = "\\label{fig:acc_plt} Accuracy data for each participant for the split-half paradigm. ", echo = FALSE, fig.align = "center"}
# make the plot
plt <- ls_acc_RT %>%
  group_by(observer, targSide, session) %>%
  summarise(Accuracy = mean(accuracy)) %>%
  ggplot(aes(targSide, Accuracy, fill = session)) + 
  geom_bar(stat = "identity", position = position_dodge()) + 
  scale_y_continuous(breaks = c(0,1)) + 
  theme_bw() +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "top", strip.text.x = element_text(margin = margin(0.01,0,0.01,0, "mm"))) + 
  scale_fill_ptol() +
  facet_wrap(~observer)
plt$labels$x <- "Target Condition"
plt
```

```{r rt_plt, fig.cap = "\\label{fig:rt_plt} Distribution of reaction times in split-half paradigm.", echo = FALSE, warning = FALSE, message = FALSE, fig.align = "center"}
plt <- ls_acc_RT %>%
  ggplot(aes(rt)) + 
  geom_histogram() + 
  theme_bw() +  
  facet_wrap(~targSide)
plt$labels$x <- "Response Time (msecs)"
plt2 <- ls_acc_RT %>%
  mutate(log2_RT = log2(rt)) %>%
  ggplot(aes(log2_RT)) + 
  geom_histogram() + 
  theme_bw() +
  facet_wrap(~ targSide)
plt2$labels$x <- "log2 Response Time"

# put together 
grid.arrange(plt,plt2)
```

# Data Processing


## Split-Half 
`r invalid_kp` trials with invalid key responses were removed. After removing data from the four outlier participants (see above), all remaining incorrect trials (n = `r incorrect_trials$n[incorrect_trials$accuracy == 0]`) were removed, leaving a total of `r incorrect_trials$n[incorrect_trials$accuracy == 1]` trials over 60 participants.

### Reaction Times 
As expected, reaction times were highly skewed (Figure \ref{fig:rt_plt}), so were log2 transformed (in ms units) before the participant means were calculated for each session and target condition (Figure \ref{fig:rt_plt})

### Eye Movements
`r num_fixations` fixations were recorded. Of these, `r num_removed` fell outside of the stimuli area and were removed. Fixations landing within a vertical strip consisting of 10% of the stimuli's width were classed as central. All remaining fixations were then classed as landing on the homogeneous or heterogeneous half of the stimulus. Initial fixations were not included in the analysis. Numbers of fixations are given in Table \ref{tab:table}. 

```{r make table, fig.cap = "\\label{tab:table} No. of fixations to each side in each condition.", echo = FALSE, results='asis'}
# get fixation location
fixDat <- fixDat %>%
  mutate(fix_loc = "central")
fixDat$fix_loc[fixDat$x < -0.1 & fixDat$easySide == "left"] <- "homogenous"
fixDat$fix_loc[fixDat$x > 0.1 & fixDat$easySide == "right"] <- "homogenous"
fixDat$fix_loc[fixDat$x < -0.1 & fixDat$easySide == "right"] <- "heterogenous"
fixDat$fix_loc[fixDat$x > 0.1 & fixDat$easySide == "left"] <- "heterogenous"

# get num fixations in these locations 
table_dat_all <- fixDat %>%
  group_by(targSide, fix_loc) %>%
  filter(n < 6) %>%
  summarise(number = n()) %>%
  mutate(range = "1 < n")

table_dat_2_to_5 <- fixDat %>%
  group_by(targSide, fix_loc) %>%
  filter(n >= 2,
         n <= 5) %>%
  summarise(number = n()) %>%
  mutate(range = "2 <= n <= 5")

table_dat <- rbind(table_dat_all, table_dat_2_to_5) %>%
  spread(range, number)

# make table 
kable(table_dat)
```

## Adaptive Choice
```{r ACS plotting, echo = FALSE, message = FALSE, fig.align = "center"}
# what sort of things do we care about....

# RT by optimal choice
plt1 <- dat_ACS %>%
  na.omit() %>%
  mutate(Optimal_Choice = as.factor(Optimal_Choice)) %>%
  filter(Block_num > 0) %>%
  mutate(sdev = sd(RT)) %>%
  filter(RT > RT - 3*sdev,
         RT < RT + 3*sdev,
         RT > 300) %>%
  ggplot(aes(RT, fill = Optimal_Choice)) + 
  geom_histogram() +
  theme_bw() + 
  theme(strip.text.x =  element_blank()) + 
  coord_cartesian(expand = FALSE) + 
  scale_fill_ptol() +
  facet_wrap(~ Optimal_Choice) 
plt1$labels$x <- "Response Time (msecs)"
plt1$labels$fill <- "Optimal Choice"


plt1_5 <- dat_ACS %>%
  na.omit() %>%
  mutate(Optimal_Choice = as.factor(Optimal_Choice)) %>%
  filter(Block_num > 0) %>%
  mutate(sdev = sd(RT)) %>%
  filter(RT > RT - 3*sdev,
         RT < RT + 3*sdev,
         RT > 300) %>%
  ggplot(aes(log2_RT, fill = Optimal_Choice)) + 
  geom_histogram() +
  theme_bw() + 
  theme(strip.text.x =  element_blank()) + 
  coord_cartesian(expand = FALSE) + 
  scale_fill_ptol() +
  facet_wrap(~ Optimal_Choice) 
plt1_5$labels$x <- "log2 transformed Response Time"
plt1_5$labels$fill <- "Optimal Choice"

# plot together 
# grid.arrange(plt,plt1_5)

# what about RT by number of optimal choices
# only: - correct trials
#       - RT > 300ms
plt2 <- dat_ACS %>%
  na.omit() %>%
  filter(Block_num > 0) %>%
  mutate(sdev = sd(RT)) %>%
  filter(RT > RT - 3*sdev,
         RT < RT + 3*sdev,
         RT > 300) %>%
  group_by(SubNo) %>%
  summarise(mean_RT = mean(RT),
            sum_optchoices = sum(Optimal_Choice)) %>%
  ggplot(aes(sum_optchoices, mean_RT, label = SubNo)) + 
  geom_point() + 
  geom_text() + 
  theme_bw()
plt2$labels$x <- "No. of Optimal Choices"
plt2$labels$y <- "Mean RT (msecs)"

# same as above but using the log2_RT as criteria to exclude
plt2_5 <- dat_ACS %>%
  na.omit() %>%
  filter(Block_num > 0) %>%
  mutate(sdev = sd(log2_RT)) %>%
  filter(log2_RT > log2(300),
         log2_RT < log2_RT + 3 * sdev,
         log2_RT > log2_RT - 3 * sdev) %>%
  group_by(SubNo) %>%
  summarise(mean_RT = mean(log2_RT),
            sum_optchoices = sum(Optimal_Choice)) %>%
  ggplot(aes(sum_optchoices, mean_RT, label = SubNo)) + 
  geom_point() + 
  geom_text() + 
  theme_bw()
plt2_5$labels$x <- "No. Optimal Choices"
plt2_5$labels$y <- "Mean log2 RT"

# grid.arrange(plt2, plt2_5)

# Get accuracy for each participant 
# probably want to exclude participant 39 going by their accuracy 
plt3 <- dat_ACS %>%
  filter(Block_num > 0) %>%
  mutate(sdev = sd(RT)) %>%
  filter(RT > RT - 3*sdev,
         RT < RT + 3*sdev,
         RT > 300) %>%
  group_by(SubNo) %>%
  summarise(mean_acc = mean(Acc)) %>%
  mutate(mean_acc_ov = mean(mean_acc)) %>%
  ggplot(aes(SubNo, mean_acc)) + 
  geom_point() + 
  theme_bw()
plt3$labels$x <- "Participant"
plt3$labels$y <- "Mean Accuracy"
# plt3

# RT and Acc, does this help at all?
plt4 <- dat_ACS %>%
  filter(Block_num > 0) %>%
  mutate(sdev = sd(RT)) %>%
  filter(RT > RT - 3*sdev,
         RT < RT + 3*sdev,
         RT > 300) %>%
  group_by(SubNo) %>%
  summarise(mean_RT = mean(RT), 
            Accuracy = mean(Acc)) %>%
  ggplot(aes(mean_RT, Accuracy, label = SubNo)) +
  geom_point() + 
  geom_text() + 
  theme_bw()
# plt4

```

```{r ACS_rt, fig.cap = "\\label{fig:ACS_rt_plt} Distribution of reaction times in Adaptive Choice paradigm.", echo = FALSE, warning = FALSE, message = FALSE, fig.align = "center"}
grid.arrange(plt1, plt1_5)
```

```{r ACS_rt_optchoice, fig.cap = "\\label{fig:ACS_rt_opt_plt} Response Time (ms) by number of optimal choices", echo = FALSE, warning = FALSE, message = FALSE, fig.align = "center"}
plt2
```

```{r ACS_acc, fig.cap = "\\label{fig:ACS_acc} Mean Accuracy for each Participant", echo = FALSE, warning = FALSE, message = FALSE, fig.align = "center"}
plt3
```

## Foraging

```{r plotting foraging, fig.cap = "\\label{fig:For_switch_rt} Switch Rate and Response Times (seconds) for each participant accross conditions", echo = FALSE, warnings = FALSE, message = FALSE, fig.align = "center"}
# again, what sort of plots are we interester in?

# mean RT by repetition rate? in each condition?
plt <- dat_for %>%
  na.omit() %>%
  mutate(sub_no = as.numeric(as.factor(sub_no))) %>%
  # filter(!sub_no %in% c(27,40:43)) %>% # missing data for these participants
  group_by(sub_no, search_type, Trial) %>%
  mutate(RT_max = max(RT)) %>%
  group_by(sub_no, search_type) %>%
  summarise(mean_RT = mean(RT_max),
            mean_SW = mean(repetition)) %>%
  ggplot(aes(mean_SW, mean_RT, colour = search_type)) + 
  geom_point() +
  # geom_line(aes(group = sub_no), alpha = 0.3, colour = "black") + # do we want it on one plot?
  theme_bw() + 
  scale_x_continuous(breaks = c(0.5)) +
  scale_y_continuous(breaks = c(10, 30, 50)) + 
  theme(legend.position = "bottom", strip.text.x = element_text(margin = margin(0.01,0,0.01,0, "mm"))) +
  scale_colour_ptol() +
  facet_wrap(~sub_no)
plt$labels$y <- "Response Time (secs)"
plt$labels$x <- "Average Repetition Rate"
plt$labels$colour <- "Search Condition"
plt


```
